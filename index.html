<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Build Tables in the OMOP Common Data Model • OmopConstructor</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Build Tables in the OMOP Common Data Model">
<meta name="description" content="Provides functionality to construct standardised tables from health care data formatted according to the Observational Medical Outcomes Partnership (OMOP) Common Data Model. The package includes tools to build key tables such as observation period and drug era, among others.">
<meta property="og:description" content="Provides functionality to construct standardised tables from health care data formatted according to the Observational Medical Outcomes Partnership (OMOP) Common Data Model. The package includes tools to build key tables such as observation period and drug era, among others.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">OmopConstructor</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/buildObservationPeriod.html">Generating the Observation Period Table</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ohdsi/OmopConstructor/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="omopconstructor">OmopConstructor<a class="anchor" aria-label="anchor" href="#omopconstructor"></a>
</h1></div>
<!-- badges: start -->

<p><strong>OmopConstructor</strong> is a package that contains functionality to construct standardised tables from health care data formatted according to the Observational Medical Outcomes Partnership Common Data Model (<a href="https://ohdsi.github.io/CommonDataModel/" class="external-link">OMOP CDM</a>). The package includes tools to build key tables such as observation period and drug era, among others.</p>
<div class="section level2">
<h2 id="tested-sources">Tested sources<a class="anchor" aria-label="anchor" href="#tested-sources"></a>
</h2>
<p><a href="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-local-omopgenerics.yaml" class="external-link"><img src="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-local-omopgenerics.yaml/badge.svg?branch=main"></a> <a href="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-duckdb-CDMConnector.yaml" class="external-link"><img src="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-duckdb-CDMConnector.yaml/badge.svg?branch=main"></a> <a href="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-postgres-CDMConnector.yaml" class="external-link"><img src="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-postgres-CDMConnector.yaml/badge.svg?branch=main"></a> <a href="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-redshift-CDMConnector.yaml" class="external-link"><img src="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-redshift-CDMConnector.yaml/badge.svg?branch=main"></a> <a href="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-sqlserver-CDMConnector.yaml" class="external-link"><img src="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-sqlserver-CDMConnector.yaml/badge.svg?branch=main"></a> <a href="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-snowflake-CDMConnector.yaml" class="external-link"><img src="https://github.com/OHDSI/OmopConstructor/actions/workflows/test-snowflake-CDMConnector.yaml/badge.svg?branch=main"></a></p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install OmopConstructor from cran using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"OmopConstructor"</span><span class="op">)</span></span></code></pre></div>
<p>Or, you can install the development version of OmopConstructor from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"ohdsi/OmopConstructor"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="main-functionality">Main functionality<a class="anchor" aria-label="anchor" href="#main-functionality"></a>
</h2>
<p>Currently <strong>OmopConstructor</strong> main functionalities are:</p>
<ul>
<li>
<a href="https://ohdsi.github.io/OmopConstructor/reference/buildObservationPeriod.html" class="external-link"><code>buildObservationPeriod()</code></a> to generate observation periods based on the data already in the <code>cdm</code> object.</li>
</ul>
<div class="section level3">
<h3 id="building-observation-periods">Building observation periods<a class="anchor" aria-label="anchor" href="#building-observation-periods"></a>
</h3>
<p>You can generate the observation period table directly from the data contained in the <code>cdm</code> object, which is particularly useful for creating custom observation periods on a study-by-study basis. In this example, the observation period is defined as one record per person, starting from the first available observation in the data and ending at the earliest of the following: (1) a recorded death, (2) reaching 120 years of age, or (3) the extraction date (here, set to 01-01-2010).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/omock/" class="external-link">omock</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/OmopConstructor/" class="external-link">OmopConstructor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/omock/reference/mockCdmFromDataset.html" class="external-link">mockCdmFromDataset</a></span><span class="op">(</span>datasetName <span class="op">=</span> <span class="st">"GiBleed"</span>, source <span class="op">=</span> <span class="st">"duckdb"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Reading GiBleed tables.</span></span>
<span><span class="co">#&gt; ℹ Adding drug_strength table.</span></span>
<span><span class="co">#&gt; ℹ Creating local &lt;cdm_reference&gt; object.</span></span>
<span><span class="co">#&gt; ℹ Inserting &lt;cdm_reference&gt; into duckdb.</span></span>
<span></span>
<span><span class="va">cdm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/buildObservationPeriod.html">buildObservationPeriod</a></span><span class="op">(</span>cdm <span class="op">=</span> <span class="va">cdm</span>,</span>
<span>                              collapseDays <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>                              persistenceDays <span class="op">=</span> <span class="cn">Inf</span>, </span>
<span>                              dateRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1900-01-01"</span>, <span class="st">"2010-01-01"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                              censorAge <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span>
<span><span class="va">cdm</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── # OMOP CDM reference (duckdb) of GiBleed ────────────────────────────────────</span></span>
<span><span class="co">#&gt; • omop tables: care_site, cdm_source, concept, concept_ancestor, concept_class,</span></span>
<span><span class="co">#&gt; concept_relationship, concept_synonym, condition_era, condition_occurrence,</span></span>
<span><span class="co">#&gt; cost, death, device_exposure, domain, dose_era, drug_era, drug_exposure,</span></span>
<span><span class="co">#&gt; drug_strength, fact_relationship, location, measurement, metadata, note,</span></span>
<span><span class="co">#&gt; note_nlp, observation, observation_period, payer_plan_period, person,</span></span>
<span><span class="co">#&gt; procedure_occurrence, provider, relationship, source_to_concept_map, specimen,</span></span>
<span><span class="co">#&gt; visit_detail, visit_occurrence, vocabulary</span></span>
<span><span class="co">#&gt; • cohort tables: -</span></span>
<span><span class="co">#&gt; • achilles tables: -</span></span>
<span><span class="co">#&gt; • other tables: -</span></span></code></pre></div>
<p>We can use <em>OmopSketch</em> to visualise the characteristics of the new observation period table that we have built:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://OHDSI.github.io/OmopSketch/" class="external-link">OmopSketch</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/summariseObservationPeriod.html" class="external-link">summariseObservationPeriod</a></span><span class="op">(</span>observationPeriod <span class="op">=</span> <span class="va">cdm</span><span class="op">$</span><span class="va">observation_period</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://OHDSI.github.io/OmopSketch/reference/tableObservationPeriod.html" class="external-link">tableObservationPeriod</a></span><span class="op">(</span>result <span class="op">=</span> <span class="va">result</span>, type <span class="op">=</span> <span class="st">"flextable"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="running">Running<a class="anchor" aria-label="anchor" href="#running"></a>
</h2>
<p>Configure a <code>.env</code> configuration file using the <code>example.env</code> example settings file. Supply your JDBC driver and place it in the <code>drivers</code> directory.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>docker build . <span class="sc">-</span>t omop<span class="sc">-</span>constructor</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>docker run <span class="sc">--</span>rm <span class="sc">--</span>env<span class="sc">-</span>file<span class="ot">=</span><span class="st">".env"</span> <span class="sc">--</span>network<span class="ot">=</span><span class="st">"host"</span> omop<span class="sc">-</span>constructor</span></code></pre></div>
<p>After successful execution the <code>observation_period</code> will have been truncated and recalculated.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=OmopConstructor" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ohdsi/OmopConstructor/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ohdsi/OmopConstructor/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing OmopConstructor</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Martí Català <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3308-9905" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/OHDSI/OmopConstructor/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/OHDSI/OmopConstructor/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=OmopConstructor" class="external-link"><img src="https://www.r-pkg.org/badges/version/OmopConstructor" alt="CRAN status"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martí Català.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
